<?php
include_once '../bc/bc.php';

$miners = [];
$users = [
    'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRQy9oZlAzUzVvYlVzRzUKMFdvMXdpRGdnSVVLVFB3TlV5Sm1ja3dIb016UTAwbVo1c3NXdGhma2xJK252eXEvaGlGYWhXd1NDdjVGa2VSSApJbXpyR2Vhc1VzMFJzSHRNVk1yUzltVVFVbE9mWmYvQjAxakVXVmFVbFRKM3QxWEsrbTE1TkQ5bFdKQ3hJTzBvCjlhQUtGRUdaNEZHcXRjNUpxT3VFY2ZnNW1raVZaUnIwU0JrNmN3K29iMFg4OFY0cTZ6NlVZNTFKU2lOcFhnWGUKUzc4ZE5EWDQyNVlIV01jNHVjUUhwRlJsV2pGQ2R6SVdwKzU1a090QndIQmFqM3ZNM0NxRERRMFJXcEJwRm52NgpzeFlJZEU1YlRyUEh4Rnh4VElPQ2J2aExQV2gyRTlVWTFwNm5PVTMxcStlVEk3UHJTWU5BNzRjaFRFTWJUd2dmCjY0eitSWXNEQWdNQkFBRUNnZ0VBYjZobzA0UUFGRzNyQTZwVGdZUHNKdmJHbVhySWQvdy8wZnBRMlNHbVJ4am4Ka0JJOTFML1VyaTd1a1oyaURvYmtheUhlSDZiSkYwWTNFRUhCdms4YmJOdlpNcmJ4SzA5RDhEbzJNWTNOc3VDRQplenY4Ukh6UlBVNitYWTFGTjFGSkFhQzBWU0dOT2JjNGpPaW1wVG1xQlV3Q1VNUXR3RVA3Q3Z4bSt5NDNvdUNNCmFDTUFOdHlnWnhtK2tiaXBRVnhTWU1paklPT2p5NzhrRnNZU2JXOE1hOE11ME9USnBwbm1oRFRlT29XNXJKeVMKRHN1M3g2NVRPNnJHUmZuN3ZZYWx2SHFZbTdiUFZjRVVwMkFnaTQ2YWRXeFRuM2tySzNoMzFrMlk5ZTM0anFnVwo3U0Z5NkxTcVBvZUNJMGlyQzhrR2U1dWNVZ21wdWt4K2FiTzV4N200QVFLQmdRRHJpdHNwbjRrcW1DbGw3QnhECjgwYWxjZTlQNlRmWUlqc1hFY2o0eS9YNEZYQWdsZ2w3MlFHREVXZGRBTmFIVENiT0hMWjYzN1NtYkZRSk9mcXUKSTdDMGJiRllheU9HeFJSblFUWnNvajY1dDZ6dnRQT0dPSUtubmRIUng4Qi9PelhHTkZWM1hNdGN4VlU4em1QMgpzaEo4KzNlZmhaK2Z0R2MrZHNlSUpYeTlNUUtCZ1FEUUtGdURYeDJnQUFSeGtmYVZVM3B4UmtzY05tNTArOXhKCmoxWlV4Q2VPVXp3Y2kxWDZRSnR2Z0NHNGQvK3JWeE9DSVorQk1XZHp1TFRiM2E5Z3pMNjhZeTlsbVQ5VFQ5bnEKMjkzeTNLeUpDTWtuNkVjZUJEd2RadStZSC9VWWEvWS9vb1RNVUppeVBVeGZBdHFvZ09nQVBLbnFUYzRkS0YxVQpxVHZMYXFudWN3S0JnUUNQVjBwMnN5TGJiQXhOZlhuYUZGT2EzWkpnbERJcTh2SDQ0UmJuNmQrL1lQU0NzQ3dIClZaR28vTTlsZHR3WExFMjFReDM5K3VQS0g4U29kTU5NZEdYVjk2ZGtncGIxTGp4emRlazBCU3lkQXQxWVowdUkKRkIzVythRTF4QlV1bUk3cUZ2RW9HYTJjd0c1VitkZzF5anFjR3NDNnNLdnFtZlAydkh4REsyVVZFUUtCZ1FDcgp0czhmUldTYjY4ZStwR2xrNzlOUEJHekxuajlxYzZaYWJFc01iREF4WVlweUJhTnNhTVdRcW9PbXVCOEtDakFHCnBwUDlNSE1sN0ZZT0ZnY3A5RnpYN1g1WThwMWhyYnFYMnI1eUxRYUxtTnJQOS9aSzFiVjlqNy9RbjNSQnJEWWMKY29YWVFoaGsyTnBhZW5GRWxlcE0zNzVQa2RXWkNnWkw0N3QyNTh1ODd3S0JnUURxVWM1T1ZmRFVFbG96ZGVVQgowVWlUNjhsNGgzSjErOUoxdHZjV1kxUzE1VlJUNEl1Y1FVOTNHanhwRURZSXBsMUR1akU1eW8wTHBMcmI5cndsCnJkbG92VWZwQU94MTEzS0hFZmtyREpUalpaQXhmcyt1c3Q1SXFranAzSXhPcU84QmRmcWdCTlpKUzhabWo2YUkKdXhmTncwSUNSamxqZlBpc2RIYnBwd3YxSWc9PQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==',
    'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFZZSFhGYTJTakMwSnoKdmQ2WUpEZFlSS1hJeGl6QzU1NGhHWEZud2tmdHpUdUMrUFU4V09ESVQxMWxad2ZUL2lhYXF2b3dhZTZYZTdkbgpidmFHVmxFS2ZCbFdEOVRIY1VjYkhvK1VGUlFmUXZxM0VZbmozelhqY1BRQkpLM041aTNDVzNqMzJEeVNHNTdzCjVYNUhTT2ZPaGpTUHZKTk91WXg1eERpSlM5ZXVQd2tveDBOdUdETS85blVkdytyU2NoUnFyT3owT3lJZzdCWC8Kd1g1aVpvaWRWeWl6dVptNU9RVmx6RzlkZGpKbkUwK29QdnhoeUpGRmV1WUcyWlQ1cGdoUStCdjhJS0NVU09vYQp2THdDUHIvZWt0RXlRdjFOSkxxMlJiZkE3L0cxdnBiejZwUjE4TXhGVTVqSjJ1aS91YVRSZXRKbWhSZXk2S2VYCmtWcTFxd0huQWdNQkFBRUNnZ0VBUU1TZjJ3WUhMU3A4eUU4bzR2dVRSUnJKUzlGRHd3RzFVUXk5REthL1dLS0UKWHZRYzFHMlNCWnQ1bVE4V0pEWXdGNkN3Z3NPVTVheHE5bDJMUFNtMFBiOS9uVXorNUc4eEN6MVNqYnQ4T1NVRwpuMDBXa3ZHdEZOV3pheWxzREdUREhRelJBa0pEMklIRDB0cXlZd2J4UGhJa29FQzRZaHdXVk52SDRYMEJBZVdZCkRqNkdKR2kxS25MMktPYmtYVFFMK3FDSmtFemFReWxROWwyTU1rZ0xLS3oyQXo1YldkeWxJdUM2MjBKeGZ6M20KZFdERkRSQUdZY1ptNVltUG1xMThFWjdsWDlzU2tYckoveU1uSWw4TjV2QXZHSUJEZE5xMGxUcGhWcHBPdHo5NwpuLzhFV00wNk83eVg2WWdkZEFHbFRKRWNnOTZyS21DWnJtdEJmRjJ3a1FLQmdRRDkwazNNUjRhRkt3NGlrS1ZwCitoZHNIemo0N3lrSDY4cGd0dFJ0STl0VmZWU0RFSE9XbUtDbEJjRnVLeFF0REFHT2JhYThmbTdFSHhyZEIwdmEKTHYrRG1Jbk5qa01zZS9nSFRxVm1tRUZNVlByMlQyMkNzM092ZVZrL2pkc3dSTGZDcVR4SS9ZKzc5eHUwZU1tVwpJbmxGdjFVbiszdG8ycU1hZ3Bwa0Nvcjh2d0tCZ1FEWE5VcUhHK0NCMWloSklneTNFcjludjdETGJ2MGxCN0o3CktRNWo5R0NqQXFyMmM1YnpHbEMxdWo0U1dlTHJIc1lRYUVhMC95d1pMbitIaWRZZGQ0UTlOUGFUSFFleVM3K0cKc2lIOFRhbk0zNFJ5eC9qVWhyOGQ1Zzg0azMvQmlZMVpWaW9hQVRUTFhobkloTEozZE1wZmV0NVljWnlIYWdCawpwZEU0YnVJODJRS0JnUUNJb0VScVduSHBpc1NBREpaTmxtWTNPQk5GeEE2MUNkSVUvelVYVG43STVMNnlFZy8yCkYxQVpwQ0I3dWNxUmVPMzVpY0ovb2hyampNNjcvU3B5Vm13Sm5QbElZWFI5SkhuZERSTnhSekdXOGdOb3hGWngKVFVGUFNpV2xWU21RTU4wdGRrVlNFTkxtM2R2VzZGR3ljL29OZGpGVFpVWUhxZkN6MjJ0WndHY1NKd0tCZ1FDWgoxMVdraWRBTzRJbkI1ZDVURE1yWkhwWUNoeC9kVmNoSDlJeDk5WmNUVUhmb1g2NzdyOGNjY2J1bm9LdnZTZnRxCmhUQnVlSzhNZlVuYkdUUi9zZzFOTjh4QVZCTkphSTdNZWhDRGJQMUNJRkp0UHZobzdMNDRZRnBuSmtIQWwxVDkKRlBSWnpKengrQjNVVXMvRlJ5N1gzRnlQdXYrYmFiSklRS1QwZzRlazJRS0JnRkdhY1ZWT2JJK3JvVC8xdy9QdQorZ3VFNUZDK2haWlFGdkFNVWFuUjdqdnhTQTl3TlJCbHVvcFczdlZnN1JrSHpaRlp4S2VVQnA3d1dUVS9wTlhuCkRwSFlsaDZnY2ZvVlg1UU95M1RGNTJRbEJpU3BmUWszY0hKaWdobVlwSGlQNDhua1dnWHRpOUExVTlSNUdjcUgKeVczdTU2SEQ3Q1BhNTIxN3N4ZVAwVVlBCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K',
    'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRREJFeHVteUZCN3F1WncKRXM2R0h2V3pXR2xwQjBSdnh6MHNrSm81d1cweVVnWHArNHFBUkNUYVlRSmVHQkJEb3JqZ3NrSlBzNHFGcEtyUAp5d3E4VTNEdXdDV25hT1JEVFBhdGlRWTNSa0ZST014bFNaeXRGeEFkbGJJVGtpdU5RUEEwbDBQN3BnM0U1TlZ4ClNwSk0rOTRnQUE0QlZ4WTJTa1BwQWxqUmp4TDhOS3Y5NHJMSXJZMmI4Q2ZXUlpwdzNUWndtSkU5SlFDK2pRS28KVzNYVTNmRFNSOTg4TzAyRkdVdzU0SjR3ZGNvQ3FnUk9aOUo3Vjg0dUlEWFYwZFNoOVYzRzVhV20wWXFnTWQwTQpKZTVQSk9kNmMyeTZYL0FnM3h3bWk1MEJZR1ByaDQza1B4bWR6L25UVHU3TTBpNGVIRllXMy9yalMzM2FZQWNvCmZLZjU1QzVSQWdNQkFBRUNnZ0VBZUVFaGdPRFZHQ0dhdzRWRE10QkhzbnZIczgzOTl5eitVaXFDbEtTQUVjNTYKdG9DZ2hFRnRQc01iU1dYdGcyTHZpYXdkbHl5NWc0SExqZjdsNGVTS3UzbmNPZ2dmM0Rjc2tXdDkvcUY0ZjFGRQpKWFlTNnRBcGpuTzFaWEV1UlIyRVB3MVVINElPbzJydjhrOUREa1gxMUxLVUJvdXFYd2drZ2hXZkltN2RvVTFMCkYxbVB2Zy9MMTBzWjNCMGFvVGpMWTBlVGdtY0ZrejdFQTJTTlU3bDdYT1BkZlRGNTR2R0ZTekNnREdVVlpLZ1QKcUlBaTE4WnBZOFRZZkJnQ2lqQzVCZERmelh2Y3RUSVJRYTM3NmhNZXR0VHEyV0w2bzZ6REFjSVQzS0xXSG9qbgpjSisrMlI2WGZEbFJWeG50REdIMWQyeXlEaWU5SzhhOTcyQkRRMWNEclFLQmdRRHplckhVKzRpSDdlc2pwQUYrCnVPL1p5VTV5bll4Qm1XczRMYWVReWFtc1JUQ0xIcXN5ZFB1SnQ0Z1JyNEJjcHJvdER3Q3ZUV1dPb3UvUmV4eHEKRldDM2Y3OEFzMUdXdWczcEF5ZUZEd1ZmN01PSVBSWjBRZ284RjJ6d1Z0Sm92VThPbmlPZ1pIOExlbG4yMXRZMgpJb1NWaHpxRm45aytzSThuYm9Ub0lINnZqd0tCZ1FETEFOdGRnWHl2NDkvRXVmMWZaS1RqeitFbHAyMHlaeE5iCnYwUTJSWXN2YUVOUEVRVWJwTUd5bVpiQzhvRkhWNmFDN0NycVhBUUtLS2VVL0ErZDB3dnRjMmtEUDZCZ0trSHcKOEVVSnZYWHRvVkhJZDA0V1NSQkFGN2UzVjU3NmpSSnlsVWRZdTB4Znc1bXB5NkZySldMNHNIN3lqdWFybzhsTQp0cCt2bnU1VUh3S0JnRUJCMFV6MFZVUUtkbFFocElOZEsyKyt3UVZlcnZWaEYvcnJrWjJVbTBMcnY3UDNsQmJzCjZMV2Z5amxncCsvTDBMYXpqdXEwOG1pQ2QraEJKVzZaMWJ5WDZrQzFFb05FOXdiWDNrWXZnS3VnUUxwajVOa3AKMUttblJRam80UDdqZDBuVVVuS3lFeFZrWlBuUUdSaVFZNDFTOHc3dzhOU3FwQjB6L2IrRlUrbmhBb0dBTmt6QwpZSjZVTlpBa2VNQ3ZMMmNDWEJWc3lkK2c2OHg2ZHg0UUp0d3ZRTDBJMUF0ZmJHZURrRHhaQVVoUW9ENm53WGxlCmVWV25sdmdNNjJNSTRsUmphbDVtaG9Ic2FneWptc2tLRG5McEttanVNVXNJVGhtNUNRdlBEbkdYaXJsVlorVGEKTXJmVzAvN0VDWkQ0V21xanNKVzFQemhPSnpjbVR5akNTZjJmRGswQ2dZRUE0QUlzUmd3VXczRTQ2dG0wQXJQZQpPTkhzMi9lNTZyT0NPT1V5cTZpS05WQUlRaWRnZnR4UlI5a0lIMU5KSTlKMTZZMGlVK3o1L1FqU3BrQkxIK0xsCkh0VHUydEVMNVdQNkNPS2M0UlVTQXBrMTQrOXFIZ3NIUEFUeDdmSlhXTGI1Z05OSEpjWExpNUwySFBYdkdzRVcKVjlzWnVmd0pCZlNYeHBHTDJSWFd0Mzg9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K',
    'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ25YWEl5T0JyaTFKc0wKTTE2Z3Y1dVdXRUZuZjZBVHVZbDJvOXhxcWNyRU9rOWpsMlNCc1Q0ZE1Jb3pwVmxPYVVlVlB6WGhnZmFmak9ERAp5Nkk1bkpucGgvdnB3QXRKZVlsZU9OTVVRRWRRTmpPSlB0Vm5hMHZyN3JJd213RlRJbkpiVVlFRlhPTTYzU0NTClBaY25WQlBGUHd1STVCdGNxK0UwVW1CQXlaRk95UVI1OTI5U0Q2U05OZjBKUC84WkI3N1dObWJ1eTg5eU5USWYKQUN1c1NoMWR0Z05LVDVhTTIrUnF1YnpTWTlOUGpJWVV4MlVpOFZZZmpHWCtHdUZxYm5sOUNQTTNhWTJBVnhtUApGaU1JeU5FK2NPSUw4RG8wUUdyOHFzUUFYSGVBOFZvdFBzck1lNE1MY1FZdVVXVmdMVnZYOHFBdXFRamVzanNWClVDOG5sMUs5QWdNQkFBRUNnZ0VBSklkZ3hWVTVpUWllVG5PSDA4MytSM0k3MURzbTFTZEp1WHRLUUgyT3BBV1cKRGthY3lUSEdQTmk3VVVwbGs1ZW02QXhEMWxSblg2dC80end1ekNSQjg1YWFoUXBGYkdQNmQzWXZtOXZydExZZgp5WFROWHlVc0RQS3NNYStqT21IcVU4UVdSUFZoSXhmZ1pBck5VdWdtNklZNkhrYXJNaTdSbUhuaVNFRzJWVnR2CjZUYnppbWFURkZCbzZHaExjbEQ3RUlFNkpFc0dRc1FNZFZoK1lRT0RUQ2loaUhKREMwRVVOL3Q0V3FKTHRCMFIKTmhqanh4WElYVXhDMldZeFBBQVpqL0ZQWDM4THhKM1pYYUV6OXBVR3NpcEltbkFjZGJ2ajFuRngyWHFUU2J6LwovdHRiMjJuRXZjVFprNzJYYjRrSXl5a0UwQnBTOURSMGttaHo4WXM0QVFLQmdRRGVNN1J6OUIzbjNQR0ZwSE01ClNob2E1QjZiSkQvZU1PWXJqaS83bzZuL0ZrUERuQkZIeVNiV1BBS0kyVlBPUktQTERsUlRYcjdIZ0tYdEwxRG0KR1FENG11VzNkS3NsR092L1Y4ZjlVdGJvZ3hVa2loSG1UMlJrRS9lSHcwL3BwRzRXa1orbFAyY2plZnlMMU1oMgp4VjZWbiszOUpYNnRnOThrNDBhNTYvQTBUUUtCZ1FEQTBuTzRWZ2dlSStSTkpGbE5vdVRQY2Q5NjhOTlhoZGxaCkoxaTJLYzhBeW1IM3lXRUpndXJtTjVraFFDeUtwNnlBUkI3OXVOdk5SdWd2K1FIcXE1cnZJUERZOUUrc2ZaVHkKTlJ5VVkrTVJRKzV5WmUrci9IbzFpdmZQelNZWTg3UEZIU0wyd1JoaEpzS0ZYU0VTYzBoVFVPWC9YVjVySVd2WApwY2JwQnZxUU1RS0JnUUN0VFJKTzVYUjFwRUxUQXNIRFN1STFXdm5yOGtmRjJjbUs2dWpOa0laRHAyL09ubWh6CjNwVGx2Z1FVQzd4clFlbWxzMVZkZUtXL0g3MUowZjk4bHIvRkpicEliVHdXUU91L1NRMTNyQ1psVGVjdGltb1AKZ0poQjNialBNQ3VoaEZkQVR1OStpSWEraXFQSHczdGQ5dTJnTVE0Q3hEMmF3eUZFdWVZdGw3RE9lUUtCZ0J1MApJUHd6SUNkMGNMREVzQy8vWDNDT285VStGSjlXazh2RFkzT0l2ajBXMXN5TEdtNExhVVI2YUgzbWduL0paM2RtClVpMlNDY0tNbFgrTy96K0FPRnB6R1NlU3NuL042MENCY1FIQStEYmEwNytMOWN0NEV2YnVhSHhxdFRhUWpSdWMKL0JFSDNVRFlHTXFnZnNmdjJFeGdLeXR0ZHN0ZG1lajU0SUpLaG1XQkFvR0FVclRjSEJUY2FBOFpKd1FpRll3cwprQS82RStMU3ZUd2NZWUJTQ1liRytVT1JpQkJ3MEIzZWUxQmRZcVVUOWlXTi9Xd3pzc3VzYlJxS3JKQmdQbGd5ClY3Y3dTMkIrREJpNkxjbFlMK25YZVBhWXVQVno0R215UXN0dzNucUdvM2JxdjRiV2NUNGFKcEUyYmk5eC9ieEYKbUtTVzZ3Q0wranpXNm5kRnMxWjdxVFE9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K',
];
foreach($users as $p) $miners[] = LoadUser($p);
// $miners = [NewUser(),NewUser(),NewUser(),NewUser()];
NewChain('./tchain.json',$miners[0]->Address());
$chain = LoadChain('./tchain.json');
$c = count($miners) - 1;
while(true) foreach ($miners as $i => $miner) {
    if($c === $i) $receiver = $miners[0]->Address();
    else $receiver = $miners[$i+1]->Address();
    $block = NewBlock($miner->Address(), $chain->LastHash());
    $block->AddTransaction($chain, NewTransaction($miner,$chain->LastHash(),$receiver, $c-$i+1));
    if(!$block->Accept($chain,$miner)) break 2;
    $chain->AddBlock($block);
}
foreach ($miners as $miner) var_dump($chain->Balance($miner->Address()));
var_dump($chain->Balance(STORAGE_CHAIN));

$file = fopen('./tchain.json', 'rb');
if(filesize('./tchain.json')) $data = fread($file, filesize('./tchain.json'));
else $data = '{}';
fclose($file);
$data = json_decode($data,1);
foreach($data as $hash => $block) {
    var_dump($hash);
    var_export(unserialize($block));
}